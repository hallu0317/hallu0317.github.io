---
title: AWS VPC
date: 2022-12-21
categories: [AWS]
tags: [aws]
#pin: true
---

## VPC(Virtual Private Cloud)

### VPC 구성요소

- 프라이빗 IP : 인터넷을 통해 연결할 수 **없는** IP 주소로, VPC 내부에서만 사용할 수 있는 IP주소로 VPC에서 시작된 인스턴스 서브넷의 범위에서 자동으로 할당되며, 동일 네트워크에서 인스턴스 간 통신에 사용된다.

- 퍼블릭 IP : 인터넷을 통해 연결할수 **있는** IP주소로 인스턴스와 인터넷 간의 통신을 위해 사용한다. 인스턴스가 재부팅되면 새로운 퍼블릭 IP가 할당.

- 탄력적 IP : 동적 컴퓨팅을 위한 고정 퍼블릭 IP주소로 중지된 인스턴스 또는 분리된 네트워크 인터페이스와 연결되어 있는 경우 시간당 요금이 부과된다. 사용 가능한 탄력적 IP 주소는 5개로 제한되며 이를 절약하기 위해 NAT를 사용

- Subnet : VPC는 리전의 모든 AZ에 적용되며, 각 AZ에 하나 이상의 서브넷을 추가할 수 있다. 하지만 서브넷은 단일 AZ에만 생성할 수 있으며 여러 AZ로 확장할수 없다.

  - Public Subnet : 서브넷 네트워크 트래픽이 IGW로 라우팅이 되는 서브넷
  - Private Subnet : IGW로 라우팅 되지 않는 서브넷
    > 일반적으로 인터넷망을 통해 서비스를 수행하는 서버는 퍼블릭 서브넷, 보다 높은 보안성을 필요로하는 DB서버는 프라이빗 서브넷에 생성

- 라우팅 테이블 : 각 서브넷은 서브넷 외부로 나가는 아웃바운드 트래픽에 대해 허용된 경로를 지정하는 라우팅 테이블이 연결되어 있어야 한다. 즉 VPC의 서브넷 내에서 생성된 네트워크 패킷이 목적지 주소로 이용하기 위해 어떤 경로로 이동되어야 하는지 알려주는 나침반.

- 보안그룹(Security Group) / 네트워크 액세스 제어목록(ACL)

|    구분     |            보안그룹             |                  ACL                   |
| :---------: | :-----------------------------: | :------------------------------------: |
| 서비스 범위 |      인스턴스 레벨에 적용       |           서브넷 레벨에 적용           |
|  적용 정책  |        허용 규칙만 적용         |         허용 및 거부규칙 적용          |
|  구동 방식  | 규칙에 상관없이 반환트래픽 허용 |            반환트래픽 별도             |
|   룰 검토   |    해당 객체 내 모든 룰 검토    |   해당 객체 내 룰을 번호순으로 처리    |
|  적용 방법  |    인스턴스에 보안그룹 추가     | 연결된 서브넷에 모든 인스턴스 자동적용 |

- VPC 피어링 연결

  - 피어링 연결은 비공개적으로 두 VPC 간 트래픽을 라우팅할 수 있게 하기 위한 서로 다른 VPC 간의 네트워크 연결 제공

- NAT(Network Address Translation)게이트웨이

  - 외부 네트워크에 알려진 것과 다른 IP주소를 사용하는 내부 네트워크에서 내부 IP주소를 외부 IP주소로 변환하는 작업을 수행하는 서비스

    - 프라이빗 서브넷 내에 있는 인스턴스를 인터넷 또는 다른 AWS 서비스에 연결하고, 외부망 또는 인터넷에서 해당 인스턴스에 연결하지 못하도록 구성

    - 외부에 공개될 필요가 없거나, 보안이 중요한 경우 사용

  - NAT 게이트웨이 구성요건 3가지
    - 퍼블릭 서브넷 지정
    - NAT 게이트웨이와 연결할 탄력적 IP주소 필요
    - NAT 게이트웨이를 만든 후 인터넷 트래픽이 NAT 게이트웨이로 통신이 가능하도록 프라이빗 서브넷과 연결된 라우팅테이블 업데이트

- VPC Endpoint

  - 프라이빗 서브넷에 위치한 인스턴스는 인터넷과 연결되어있는 S3와 같은 공용 리소스를 연결할 수 없다. 이럴 때 S3에 연결하기 위해 NAT게이트웨이나 NAT 인스턴스가 필요함. 하지만 VPC Endpoint를 이용하면 쉽게 S3, DB에 연결

### 퍼블릭 및 프라이빗 서브넷이 있는 VPC(NAT)

![image](/assets/img/vpc.PNG)
